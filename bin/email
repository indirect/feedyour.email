#!/bin/bash

FEED="$1"
URL="$2"

if [[ -z "$URL" ]]; then
   if curl -Is https://feedyouremail.test > /dev/null; then
    URL="https://feedyouremail.test"
  else
    URL="http://localhost:3000"
  fi
fi

if [[ -z "$FEED" ]]; then
  POST="spec/support/body.json"
else
  cp spec/support/body.json tmp/body.json
  sed -i.bak "s/somefeed/$FEED/g" tmp/body.json
  POST="tmp/body.json"
fi

set -x
curl -s -vvv "$URL/email/incoming" \
  -d "@$POST" \
  -H "Content-Type: application/json" \
  -o /dev/null
